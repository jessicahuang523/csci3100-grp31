<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - components/Event/AddEvent.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato.css" rel="stylesheet" type="text/css">
  <link href="../../assets/css/plato-file.css" rel="stylesheet" type="text/css">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://github.com/the-simian/es6-plato">ES6 Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
      <li class="active">
        <a href="display.html">Summary Display</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>components/Event/AddEvent.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">71.74</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">249</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">36.20</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">1.42</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">import React, { useState, useEffect, useContext } from &quot;react&quot;;
import { Link, Redirect } from &quot;react-router-dom&quot;;
import { GymContext } from &quot;../../contexts/GymContext&quot;;
import { UserContext } from &quot;../../contexts/UserContext&quot;;
import { ThemeContext } from &quot;../../contexts/ThemeContext&quot;;
import { EventTypeContext } from &quot;../../contexts/EventTypeContext&quot;;
import {
  Jumbotron,
  Alert,
  Form,
  FormGroup,
  Label,
  Input,
  Col,
  Row,
  Button,
} from &quot;reactstrap&quot;;
import Navbar from &quot;../Navbar/Navbar&quot;;
import Loading from &quot;../Loading/Loading&quot;;
import { setupFirestoreForNewEvent } from &quot;../../utilityfunctions/Utilities&quot;;

// calculates current date and returns iso string
const calculateDate = () =&gt; {
  const date = new Date(Date.now());
  const dateLocal = new Date(
    date.getTime() - date.getTimezoneOffset() * 60 * 1000
  );
  return dateLocal.toISOString().substr(0, 10);
};

// calculates current time and returns iso string
const calculateTime = () =&gt; {
  const date = new Date(Date.now());
  const dateLocal = new Date(
    date.getTime() - date.getTimezoneOffset() * 60 * 1000
  );
  return dateLocal.toISOString().substr(11, 5);
};

const AddEvent = () =&gt; {
  const { theme } = useContext(ThemeContext);
  const { gymData } = useContext(GymContext);
  const { eventTypeData } = useContext(EventTypeContext);
  const { userData } = useContext(UserContext);

  // data to be submitted
  const [allowedPeople, setAllowedPeople] = useState();
  const [eventName, setEventName] = useState();
  const [eventType, setEventType] = useState();
  const [isPublic, setIsPublic] = useState(true);
  const [location, setLocation] = useState();
  const [startingTime, setStartingTime] = useState();
  // input date and time
  const [eventStartingDate, setEventStartingDate] = useState(calculateDate());
  const [eventStartingTime, setEventStartingTime] = useState(calculateTime());
  // boolean whether data is being submitted, will render loading when true
  const [submittingEventData, setSubmittingEventData] = useState(false);
  // message for top alert
  const [errorMessage, setErrorMessage] = useState();
  // when event submitted, will redirect to event based on value of eid
  const [eventSubmittedEid, setEventSubmittedEid] = useState(false);

  // calculate starting time from inputs eventStartingDate and eventStartingTime
  // updates eventStartingTime
  useEffect(() =&gt; {
    setStartingTime(
      new Date(eventStartingDate + &quot;T&quot; + eventStartingTime + &quot;:00&quot;).getTime()
    );
  }, [eventStartingDate, eventStartingTime]);

  // loads event location data from gymData and
  // updates location
  useEffect(() =&gt; {
    if (gymData) {
      setLocation(gymData[0].value);
    }
  }, [gymData]);

  // loads event type data from eventTypeData and
  // updates eventType
  useEffect(() =&gt; {
    if (eventTypeData) {
      setEventType(eventTypeData[0].value);
    }
  }, [eventTypeData]);

  // checks starting time, whether all fields are filled
  // then creates new event in database
  // finally sets eventSubmittedEid for redirection
  // updates errorMessage, submittingEventData, eventSubmittedEid
  const handleEventSubmit = async (e) =&gt; {
    e.preventDefault();
    if (startingTime &lt; Date.now()) {
      setErrorMessage(
        &quot;Chill, man. You need to give people some time to prep for this event!&quot;
      );
    } else {
      if (userData &amp;&amp; allowedPeople &amp;&amp; eventName &amp;&amp; eventType &amp;&amp; location) {
        setErrorMessage(&quot;Submitting...&quot;);
        setSubmittingEventData(true);
        const eventData = {
          allowedPeople,
          eventName,
          eventType,
          isPublic,
          location,
          startingTime,
        };
        const eid = await setupFirestoreForNewEvent(eventData);
        setSubmittingEventData(false);
        setEventSubmittedEid(eid);
      } else {
        setErrorMessage(&quot;Please fill in all data!&quot;);
      }
    }
  };

  // render
  if (!gymData || !eventTypeData || submittingEventData) {
    return &lt;Loading /&gt;;
  } else if (eventSubmittedEid) {
    return &lt;Redirect to={`/e/${eventSubmittedEid}`} /&gt;;
  } else {
    return (
      &lt;div style={theme.background}&gt;
        &lt;Navbar /&gt;
        &lt;Jumbotron style={theme.jumbotron}&gt;
          &lt;h1&gt;Create a new event!&lt;/h1&gt;
        &lt;/Jumbotron&gt;
        &lt;Form onSubmit={handleEventSubmit} style={{ padding: &quot;1rem&quot; }}&gt;
          {errorMessage &amp;&amp; &lt;Alert&gt;{errorMessage}&lt;/Alert&gt;}
          &lt;FormGroup&gt;
            &lt;Label for=&quot;eventName&quot;&gt;Event Name&lt;/Label&gt;
            &lt;Input
              required=&quot;required&quot;
              type=&quot;text&quot;
              id=&quot;eventName&quot;
              onChange={(e) =&gt; setEventName(e.target.value)}
            /&gt;
          &lt;/FormGroup&gt;
          &lt;Row&gt;
            &lt;Col sm={6}&gt;
              &lt;FormGroup&gt;
                &lt;Label for=&quot;allowedPeople&quot;&gt;Total Participants Allowed&lt;/Label&gt;
                &lt;Input
                  placeholder=&quot;Include yourself when counting!&quot;
                  required=&quot;required&quot;
                  type=&quot;number&quot;
                  id=&quot;allowedPeople&quot;
                  onChange={(e) =&gt; setAllowedPeople(e.target.value)}
                &gt;&lt;/Input&gt;
              &lt;/FormGroup&gt;
            &lt;/Col&gt;
            &lt;Col sm={6}&gt;
              &lt;FormGroup&gt;
                &lt;Label for=&quot;eventType&quot;&gt;Event Type&lt;/Label&gt;
                &lt;Input
                  required=&quot;required&quot;
                  type=&quot;select&quot;
                  id=&quot;eventType&quot;
                  onChange={(e) =&gt; setEventType(e.target.value)}
                &gt;
                  {eventTypeData.map(({ value, display }) =&gt; (
                    &lt;option key={value} value={value}&gt;
                      {display}
                    &lt;/option&gt;
                  ))}
                &lt;/Input&gt;
              &lt;/FormGroup&gt;
            &lt;/Col&gt;
            &lt;Col sm={6}&gt;
              &lt;FormGroup&gt;
                &lt;Label for=&quot;publicEvent&quot;&gt;Public Event?&lt;/Label&gt;
                &lt;Input
                  required=&quot;required&quot;
                  type=&quot;select&quot;
                  id=&quot;publicEvent&quot;
                  onChange={(e) =&gt;
                    setIsPublic(e.target.value === &quot;true&quot; ? true : false)
                  }
                &gt;
                  &lt;option value={true}&gt;yes&lt;/option&gt;
                  &lt;option value={false}&gt;no&lt;/option&gt;
                &lt;/Input&gt;
              &lt;/FormGroup&gt;
            &lt;/Col&gt;
            &lt;Col sm={6}&gt;
              &lt;FormGroup&gt;
                &lt;Label for=&quot;location&quot;&gt;Event Location&lt;/Label&gt;
                &lt;Input
                  required=&quot;required&quot;
                  type=&quot;select&quot;
                  id=&quot;location&quot;
                  onChange={(e) =&gt; setLocation(e.target.value)}
                &gt;
                  {gymData.map(({ value, display }) =&gt; (
                    &lt;option key={value} value={value}&gt;
                      {display}
                    &lt;/option&gt;
                  ))}
                &lt;/Input&gt;
              &lt;/FormGroup&gt;
            &lt;/Col&gt;
            &lt;Col sm={6}&gt;
              &lt;FormGroup&gt;
                &lt;Label for=&quot;startingDate&quot;&gt;Starting Date&lt;/Label&gt;
                &lt;Input
                  required=&quot;required&quot;
                  type=&quot;date&quot;
                  id=&quot;startingDate&quot;
                  value={eventStartingDate}
                  min={calculateDate()}
                  onChange={(e) =&gt; setEventStartingDate(e.target.value)}
                /&gt;
              &lt;/FormGroup&gt;
            &lt;/Col&gt;
            &lt;Col sm={6}&gt;
              &lt;FormGroup&gt;
                &lt;Label for=&quot;startingTime&quot;&gt;Starting Time&lt;/Label&gt;
                &lt;Input
                  required=&quot;required&quot;
                  type=&quot;time&quot;
                  id=&quot;startingTime&quot;
                  value={eventStartingTime}
                  onChange={(e) =&gt; setEventStartingTime(e.target.value)}
                /&gt;
              &lt;/FormGroup&gt;
            &lt;/Col&gt;
          &lt;/Row&gt;
          &lt;Row&gt;
            &lt;Col&gt;
              &lt;Button block color=&quot;primary&quot; type=&quot;submit&quot;&gt;
                Submit
              &lt;/Button&gt;
            &lt;/Col&gt;
            &lt;Col&gt;
              &lt;Button block color=&quot;danger&quot; outline tag={Link} to=&quot;/launch&quot;&gt;
                Cancel
              &lt;/Button&gt;
            &lt;/Col&gt;
          &lt;/Row&gt;
        &lt;/Form&gt;
      &lt;/div&gt;
    );
  }
};

export default AddEvent;
</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
